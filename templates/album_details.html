{% extends 'base.html' %}

{% block title %}{{ album.title }} - Details{% endblock %}

{% block body %}

<nav class="navbar navbar-custom navbar-expand-lg navbar-light">
    <a class="navbar-brand" href="/">Snippets</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="/albums">All Albums</a>
            </li>
            {% if current_user.is_authenticated %}
            <li class="nav-item active">
                <a class="nav-link" href="/user/{{current_user.get_id()}}">User Profile</a>
            </li>
            {% endif %}
        </ul>
    </div>
    {% if current_user.is_authenticated %}
    <div class="collapse navbar-collapse justify-content-end container-fluid">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
                <form action='/logout' id="logout" method="POST">
                <button type="submit">Log out</button>
                </form>
            </li>
        </ul>
    </div>
    {% endif %}
</nav>

<h1>{{ album.title }}</h1>

<img src="{{ album.thumbnail_path }}">

<p>
    {{ album.details }}
</p>

{% if songs %}

    <p>Track Listing</p>
    {% for song in songs %}

    <ul>
        <li>{{ song.title }}</li>
    </ul>
    {% endfor %}

{% endif %}

{% if album_id | int > 8 %}
<form action='/albums/{{album.album_id}}/snippet' id ="create-snippet">
    <label for="taylor-swift-album">Choose a Taylor Swift Album for your mash-up:</label><br>
    <select name="taylor-swift-album" required>
        <option disabled selected value> -- Select an option -- </option>
        <option value="1">Taylor Swift</option>
        <option value="2">Fearless</option>
        <option value="3">Red</option>
        <option value="4">Speak Now</option>
        <option value="5">1989</option>
        <option value="6">reputation</option>
        <option value="7">Lover</option>
        <option value="8">folklore</option>
        <option value="9">Choose a random Taylor Swift album</option>
    </select><br>
    <button type="submit">Create snippet</button>
</form>

<script>
    $('#create-snippet').on('submit', (evt) => {
        evt.preventDefault();

        const requestRoute = $(evt.target).attr('action');
        const requestArgs = {
            'taylor-swift-album': $('select[name="taylor-swift-album"]').val()
        }
        
        $.get(requestRoute, requestArgs, (res) => {
            $('#display-snippet').html(res);
        });
    });
</script>

{% else %}

<form action='/albums/{{album.album_id}}/snippet' id="create-ts-snippet">
<button type="submit">Create snippet</button>
</form>

<script>
    $('#create-ts-snippet').on('submit', (evt) => {
        evt.preventDefault();

        const requestRoute = $(evt.target).attr('action');

        console.log(`requestRoute = ${requestRoute}`);
        
        $.get(requestRoute, (res) => {
            console.log('loaded', res);
            $('#display-snippet').html(res);
        });
    });
</script>

{% endif %}



<p id="display-snippet"></p>


<div class="chart-container" style="position: relative; height:30vh; width:50vw">
    <canvas id="albumChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
const ctx = document.getElementById('albumChart');
const chartData = {{chart_data|tojson}};

const bgColorList = [];

for (const i in chartData[1]) {
    bgColorList.push(`rgba(0, 102, 102, ${(chartData[1][i] / chartData[1][0]) * 2.5}`);       
    };

const bgBorderList = [];

for (const i in chartData[1]) {
    bgColorList.push(`rgba(0, 153, 153, ${(chartData[1][i] / chartData[1][0]) * 2.5}`);       
    };

myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: chartData[0],
        datasets: [{
            label: '# of Occurences',
            data: chartData[1],
            backgroundColor: bgColorList,
            borderColor: bgBorderList,
            borderWidth: 1
        }]
    },
    options: {
        title: {
            display: true,
            text: 'Most Common Words in this Album'
        },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>


{% endblock %}