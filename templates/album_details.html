{% extends 'base.html' %}

{% block title %}{{ album.title }} - Details{% endblock %}

{% block body %}
<h1>{{ album.title }}</h1>

<img src="{{ album.thumbnail_path }}">

<p>
    {{ album.details }}
</p>

{% if songs %}

    <p>Track Listing</p>
    {% for song in songs %}

    <ul>
        <li>{{ song.title }}</li>
    </ul>
    {% endfor %}

{% endif %}

{% if album_id | int > 8 %}
<form action='/albums/{{album.album_id}}/snippet' id ="create-snippet">
    <label for="taylor-swift-album">Choose a Taylor Swift Album for your mash-up:</label><br>
    <select name="taylor-swift-album" required>
        <option disabled selected value> -- Select an option -- </option>
        <option value="1">Taylor Swift</option>
        <option value="2">Fearless</option>
        <option value="3">Red</option>
        <option value="4">Speak Now</option>
        <option value="5">1989</option>
        <option value="6">reputation</option>
        <option value="7">Lover</option>
        <option value="8">folklore</option>
        <option value="9">Choose a random Taylor Swift album</option>
    </select><br>
    <button type="submit">Create snippet</button>
</form>

<script>
    $('#create-snippet').on('submit', (evt) => {
        evt.preventDefault();

        const requestRoute = $(evt.target).attr('action');
        const requestArgs = {
            'taylor-swift-album': $('select[name="taylor-swift-album"]').val()
        }
        console.log(`requestRoute = ${requestRoute}`);
        console.log(`requestArgs= ${requestArgs}`);
        
        $.get(requestRoute, requestArgs, (res) => {
            console.log('loaded', res);
            $('#display-snippet').html(res);
        });
    });
</script>

{% else %}

<form action='/albums/{{album.album_id}}/snippet' id="create-ts-snippet">
<button type="submit">Create snippet</button>
</form>

<script>
    $('#create-ts-snippet').on('submit', (evt) => {
        evt.preventDefault();

        const requestRoute = $(evt.target).attr('action');

        console.log(`requestRoute = ${requestRoute}`);
        
        $.get(requestRoute, (res) => {
            console.log('loaded', res);
            $('#display-snippet').html(res);
        });
    });
</script>

{% endif %}



<p id="display-snippet"></p>


<div class="chart-container" style="position: relative; height:30vh; width:50vw">
    <canvas id="myChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
const ctx = document.getElementById('myChart');
const chartData = {{chart_data|tojson}};
 myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: chartData[0],
        datasets: [{
            label: '# of Occurences',
            data: chartData[1],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        title: {
            display: true,
            text: 'Most Common Words in this Album'
        },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>

<!-- <div id="container" style="width: 75%;">
    <canvas id="canvas"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<script>

    var barChartData = {
        labels: ["Step 1", "Step 2", "Step 3", "Step 4", "Step 5"],
        datasets: [{
            label: 'Dataset 1',
            backgroundColor: "#0B84A5",
            borderColor: '#F6C85F',
            data: [1500, 1200, 1000, 800, 400]
        }]

    };

    window.onload = function() {
        var ctx = document.getElementById("canvas").getContext("2d");
        window.myBar = new Chart(ctx, {
            type: 'barFunnel',
            data: barChartData,
            options: {
                // Elements options apply to all of the options unless overridden in a dataset
                // In this case, we are setting the border of each bar to be 2px wide and green
                elements: {
                    rectangle: {
                        borderWidth: 2,
                        borderColor: '0B84A5',
                        borderSkipped: 'bottom',
                        stepLabel: {
                            display: true,
                            fontSize: 20,
                            // color: "red"
                        }
                    }
                },
                region: {
                  display: true
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero:true
                      }
                  }]
                },
                title: {
                    display: true,
                    text: 'Chart.js Bar Funnel Chart'
                }
            }
        });

    };

</script> -->

{% endblock %}